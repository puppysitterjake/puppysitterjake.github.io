<script>
const SHEET_ID="1JbONtH3RWufz3RSgs3EnMV9cYd_37xwBOHgaU2y_yCs";
const API=s=>`https://opensheet.elk.sh/${SHEET_ID}/${s}`;

async function fetchSheet(name){
  try{
    const r=await fetch(API(name));
    return await r.json();
  }catch{
    return [];
  }
}

function card(title,img,url){
  const div=document.createElement("div");
  div.className="card";
  div.innerHTML=`
    ${img?`<img class="thumb" src="${img}">`:''}
    <div class="content"><div class="title">${title||''}</div></div>
  `;
  if(url) div.onclick=()=>window.open(url);
  return div;
}

function ytThumb(url){
  if(!url) return "";
  const id=(url.match(/v=([^&]+)/)||url.match(/youtu\.be\/([^?]+)/)||[])[1];
  return id?`https://img.youtube.com/vi/${id}/hqdefault.jpg`:"";
}

/* HERO */
(async()=>{
  const hero=document.getElementById("hero");
  const data=await fetchSheet("HERO");
  data.forEach((r,i)=>{
    const img=document.createElement("img");
    img.src=r.image;
    if(i==0) img.classList.add("active");
    hero.appendChild(img);
  });
})();

/* NOTICE */
(async()=>{
  const box=document.getElementById("notice-list");
  (await fetchSheet("NOTICE")).forEach(r=>{
    box.appendChild(card(r.title, r.image||ytThumb(r.url), r.url));
  });
})();

/* YOUTUBE */
(async()=>{
  const box=document.getElementById("youtube-list");
  (await fetchSheet("YOUTUBE")).forEach(r=>{
    box.appendChild(card(r.title, ytThumb(r.url), r.url));
  });
})();

/* SPOTIFY */
(async()=>{
  const box=document.getElementById("spotify-list");
  (await fetchSheet("SPOTIFY")).forEach(r=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`<iframe src="${r.url}" width="100%" height="352" style="border:none;border-radius:16px;"></iframe>`;
    box.appendChild(div);
  });
})();

/* APPLE */
(async()=>{
  const box=document.getElementById("apple-list");
  (await fetchSheet("APPLE")).forEach(r=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML=`<iframe src="${r.url}" width="100%" height="352" style="border:none;border-radius:16px;"></iframe>`;
    box.appendChild(div);
  });
})();

/* NEWS */
(async()=>{
  const box=document.getElementById("news-list");
  (await fetchSheet("NEWS")).forEach(r=>{
    const div=document.createElement("div");
    div.className="news-item";
    div.innerHTML=r.url;
    div.onclick=()=>window.open(r.url);
    box.appendChild(div);
  });
})();
</script>
